CREATE DATABASE gamesdb;
USE gamesdb;

CREATE TABLE pais (
    pais_nombre VARCHAR(20) PRIMARY KEY NOT NULL,
    pais_codigo VARCHAR(10) NOT NULL
);


CREATE TABLE clasificacion_edad(
    nombre VARCHAR(20) PRIMARY KEY NOT NULL
);

INSERT INTO clasificacion_edad (nombre) values ('E'),('T'),('M'); 

CREATE TABLE empresa (
    nombre_empresa VARCHAR(40) NOT NULL,
    id_empresa INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY,
    permite_comentarios BOOLEAN NOT NULL,
    empresa_avatar MEDIUMBLOB
);


CREATE TABLE juego(
    juego_id INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY,
    juego_nombre VARCHAR(100) NOT NULL,
    clasificacion_edad VARCHAR(20) NOT NULL,
    juego_descripcion VARCHAR(200) NOT NULL,
    juego_requerimientos VARCHAR(200) NOT NULL,
    juego_precio DOUBLE(10, 2) NOT NULL,
    fecha_lanzamiento DATE NOT NULL,
    activo BOOLEAN NOT NULL,
    juego_permite_comentarios BOOLEAN NOT NULL,
    juego_codigo_empresa INTEGER NOT NULL,
    juego_avatar MEDIUMBLOB,
    CONSTRAINT fk_juego_clasificacion FOREIGN KEY (clasificacion_edad) REFERENCES clasificacion_edad   (nombre),
    CONSTRAINT fk_juego_empresa FOREIGN KEY (juego_codigo_empresa) REFERENCES empresa (id_empresa) ON DELETE CASCADE
);


CREATE TABLE tabla_configuracion (
    porcentaje_comision INTEGER NOT NULL,
    id INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY
);


CREATE TABLE negociacion_empresa (
    id_empresa INTEGER PRIMARY KEY NOT NULL,
    porcentaje_comision INTEGER NOT NULL,
    CONSTRAINT fk_empresa_nombre FOREIGN KEY (id_empresa) REFERENCES empresa (id_empresa) ON DELETE CASCADE
);



INSERT INTO tabla_configuracion(porcentaje_comision) VALUES ('15');

INSERT INTO pais (pais_nombre, pais_codigo) VALUES
('GUATEMALA', 'GT'),
('HONDURAS', 'HN'),
('NICARAGUA', 'NI'),
('COSTARICA', 'CR');


CREATE TABLE categoria(
	categoria_nombre VARCHAR(50) NOT NULL,
    id  INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY
);

CREATE TABLE admin_sistema (
    admin_nombre VARCHAR(100) NOT NULL,
    admin_correo VARCHAR(100) NOT NULL PRIMARY KEY,
    admin_contrase単a VARCHAR(100) NOT NULL,
    admin_avatar MEDIUMBLOB
);


CREATE TABLE admin_empresa (
    admin_nombre VARCHAR(100) NOT NULL,
    admin_correo VARCHAR(100) NOT NULL PRIMARY KEY,
    admin_contrase単a VARCHAR(100) NOT NULL,
    admin_fecha_nacimiento DATE NOT NULL,
    id_empresa INTEGER NOT NULL,
    admin_avatar MEDIUMBLOB,
    CONSTRAINT fk_admin_empresa FOREIGN KEY (id_empresa) REFERENCES empresa (id_empresa) ON DELETE CASCADE
);

CREATE TABLE gamer(
    gamer_nombre VARCHAR(100) NOT NULL,
    nickname VARCHAR(50) NOT NULL,
    gamer_correo VARCHAR(100) NOT NULL,
    gamer_contrase単a VARCHAR(100) NOT NULL,
    gamer_edad INTEGER NOT NULL,
    gamer_fecha_nacimiento DATE NOT NULL,
    nombre_pais VARCHAR(20) NOT NULL,
    gamer_telefono CHAR(8) NOT NULL,
    avatar MEDIUMBLOB,
    CONSTRAINT pk_gamer PRIMARY KEY (gamer_correo, nickname),
    CONSTRAINT fk_gamer FOREIGN KEY (nombre_pais) REFERENCES pais (pais_nombre)
);


CREATE TABLE cartera_gamer(
    correo_gamer VARCHAR(100) NOT NULL,
    saldo DOUBLE(10,2) NOT NULL,
    CONSTRAINT fk_cartera FOREIGN KEY (correo_gamer) REFERENCES gamer (gamer_correo) ON DELETE CASCADE
);


INSERT INTO admin_sistema(admin_nombre, admin_correo, admin_contrase単a)
VALUES ('Primer admin','admin1','123');


CREATE TABLE compra_juego (
    compra_codigo_compra INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY,
    compra_codigo_videojuego INTEGER NOT NULL,
    compra_correo_usuario VARCHAR(100) NOT NULL,
    compra_monto DOUBLE NOT NULL,
    compra_comision DOUBLE NOT NULL,
    compra_porcentaje_comision INTEGER NOT NULL,
    fecha_compra DATE NOT NULL,
    instalado BOOLEAN NOT NULL,
    CONSTRAINT fk_compra FOREIGN KEY (compra_codigo_videojuego) REFERENCES juego (juego_id) ON DELETE CASCADE,
    CONSTRAINT fk_compra_gamer FOREIGN KEY (compra_correo_usuario) REFERENCES gamer (gamer_correo) ON DELETE CASCADE
);


CREATE TABLE grupo (
    grupo_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    grupo_nombre VARCHAR(100) NOT NULL,
    grupo_correo_admin VARCHAR(100) NOT NULL,
    grupo_numero_integrantes INT NOT NULL,
    CONSTRAINT fk_grupo_gamer_admin FOREIGN KEY (grupo_correo_admin) 
        REFERENCES gamer (gamer_correo) ON DELETE CASCADE
);


CREATE TABLE participante_grupo (
    correo_participante VARCHAR(100) NOT NULL,
    id_grupo INT NOT NULL,
    PRIMARY KEY (correo_participante, id_grupo),
    CONSTRAINT fk_participante_gamer FOREIGN KEY (correo_participante) REFERENCES gamer (gamer_correo) ON DELETE CASCADE,
    CONSTRAINT fk_participante_id_grupo FOREIGN KEY (id_grupo) REFERENCES grupo (grupo_id) ON DELETE CASCADE
);

CREATE TABLE comentario_juego (
    id_comentario INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY, 
    id_juego INTEGER NOT NULL, correo_usuario VARCHAR(100) NOT NULL, 
    texto_comentario VARCHAR(500) NOT NULL, 
    fecha_comentario DATETIME NOT NULL,
    CONSTRAINT fk_comentario_juego FOREIGN KEY (id_juego) REFERENCES juego (juego_id) ON DELETE CASCADE,
    CONSTRAINT fk_comentario_gamer FOREIGN KEY (correo_usuario) REFERENCES gamer (gamer_correo) ON DELETE CASCADE
);

CREATE TABLE subcomentario_juego (
  id_subcomentario INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY,
  id_comentario_padre INTEGER NOT NULL, 
  correo_usuario VARCHAR(100) NOT NULL,
  texto_subcomentario VARCHAR(500) NOT NULL, 
  fecha_subcomentario DATETIME NOT NULL, 
  CONSTRAINT fk_sub_comentario_padre FOREIGN KEY (id_comentario_padre) REFERENCES comentario_juego (id_comentario) ON DELETE CASCADE,
  CONSTRAINT fk_sub_comentario_gamer FOREIGN KEY (correo_usuario) REFERENCES gamer (gamer_correo) ON DELETE CASCADE
);

CREATE TABLE calificacion_juego(
    correo_usuario VARCHAR(100) NOT NULL,
    cantidad_estrellas INTEGER NOT NULL,
    id_juego INTEGER NOT NULL,
    CONSTRAINT fk_calificacion_usuario FOREIGN KEY (correo_usuario) REFERENCES gamer (gamer_correo) ON DELETE CASCADE,
    CONSTRAINT fk_calificacion_juego FOREIGN KEY (id_juego) REFERENCES juego (juego_id) ON DELETE CASCADE
);
